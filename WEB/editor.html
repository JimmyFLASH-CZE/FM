<!-- editor.html -->
<!DOCTYPE html>
<html lang="cs" class="<script>document.write(localStorage.getItem('darkMode')==='true' ? 'dark-mode' : '');</script>">

<head>
  <meta charset="UTF-8">
  <title>Pattern Editor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="favicon.png" type="image/x-icon">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0"></script>
</head>

<body>
  <!-- === Horn√≠ aplikaƒçn√≠ panel === -->
  <header class="app-header">
    <div class="app-logo" onclick="window.location.href='index.html'" style="cursor:pointer;">
      <img src="JFM-X_fist_ltbg.png" alt="App logo">
      <span>Pattern Studio</span>
    </div>
    <div class="app-actions">
      <button id="loginBtn" title="Login / Logout">üîí</button>
      <div class="dark-toggle">
        <input type="checkbox" id="darkModeCheckbox">
        <label for="darkModeCheckbox">Dark</label>
      </div>
    </div>
  </header>

  <!-- === Panel aktu√°ln√≠ str√°nky === -->
  <div class="page-header">
    <h3>Pattern Editor</h3>
    <button class="back-btn" onclick="goBack()">‚Üê Back</button>
  </div>

  <!-- === Obsah str√°nky === -->
  <main class="page-content">
    <!-- N√°zev a popis + Save -->
    <div class="name-line">
      <label class="slider-label">Name:</label>
      <input type="text" id="formulaName" maxlength="19" style="flex:1;">
      <button id="saveBtn" class="action-btn" title="Save" onclick="saveToJson()">üíæ Save</button>
    </div>
    <div class="desc-line">
      <label class="slider-label">Description:</label>
      <input type="text" id="formulaDesc" maxlength="42" style="flex:1;">
      <button id="testBtn" class="action-btn" title="Test pattern" onclick="testPattern()">üîÑ Test</button>
    </div>

    <!-- Ovl√°dac√≠ tlaƒç√≠tka krok≈Ø -->
    <div class="step-buttons">
      <button class="step-btn add" title="Add new step behind selected" onclick="addStep()">‚ûï</button>
      <button class="step-btn remove" title="Remove selected step" onclick="removeStep()">‚ûñ</button>
    </div>

    <!-- Krokov√° tlaƒç√≠tka -->
    <div id="patternContainer"></div>

    <!-- Slidery -->
    <div id="controls">
      <div>
        <label class="slider-label">Position:</label>
        <input type="range" id="posSlider" min="0" max="100" value="0">
        <span id="posVal">0</span>%
      </div>
      <div>
        <label class="slider-label">Speed:</label>
        <input type="range" id="speedSlider" min="1" max="100" value="50">
        <span id="speedVal">50</span>%
      </div>
      <div>
        <label class="slider-label">Accel:</label>
        <input type="range" id="accelSlider" min="1" max="100" value="10">
        <span id="accelVal">10</span>%
      </div>
      <div>
        <label class="slider-label">Randomize:</label>
        <input type="range" id="randomSlider" min="0" max="100" value="0">
        <span id="randomVal">0</span>%
      </div>

      <div style="display:flex; flex-direction:row ; align-items: center;">
        <div style="flex:1;">
          <label class="slider-label">Delay (ms): </label>
          <input type="number" id="delayInput" name="delay" min="0" max="65535" value="0"
            style="max-width:60px; margin-right:10px;">
        </div>
        <div class="aux-switches">
          <label class="aux-toggle">
            <input type="checkbox" id="aux1Box">
            <span class="slider"></span>
            <span class="label-text">AUX1</span>
          </label>

          <label class="aux-toggle">
            <input type="checkbox" id="aux2Box">
            <span class="slider"></span>
            <span class="label-text">AUX2</span>
          </label>
        </div>
      </div>
    </div>

    <!-- Graf -->
    <canvas id="motorChart" width="800" height="400" style="width:100%;max-width:800px;height:auto;"></canvas>

    <!-- Export -->
    <div style="text-align:right;margin-top:10px;margin-bottom:10px;">
      <button id="exportBtn" class="action-btn" title="Export pattern" onclick="exportPattern()">‚á© Export</button>
    </div>

    <!-- JSON -->
    <pre id="output"></pre>
  </main>

  <script src="editor.js"></script>
  <script src="login.js"></script>
</body>

</html>